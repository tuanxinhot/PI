

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Documentation &mdash; libcamera v0.0.4+22-923f5d70 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="libcamera v0.0.4+22-923f5d70 documentation" href="index.html"/>
        <link rel="next" title="API" href="api-html/index.html"/>
        <link rel="prev" title="libcamera" href="index.html"/> 

</head>

<body role="document">
  <header>
    <div id="navbar">
      <div class="navbar-brand">
        <div class="navbar-logo">   _
+-/ \-+
| (o) |
+-----+</div>
        <div class="navbar-name"><span class="text-light">lib</span>camera</div>
      </div>

      <div class="navbar">
        <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides/introduction.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides/application-developer.html">Application Writer's Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides/pipeline-handler.html">Pipeline Handler Writer's Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides/ipa.html">IPA Writer's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides/tracing.html">Tracing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment_variables.html">Environment variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensor_driver_requirements.html">Sensor driver requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="lens_driver_requirements.html">Lens driver requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-bindings.html">Python Bindings</a></li>
</ul>

        <div class="searchbox" role="search">
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
	    <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
        </div>
      </div>

    </div>
  </header>

  <div id="content">
    
    <div class="block">
      
  <div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#documentation" id="id2">Documentation</a></p>
<ul>
<li><p><a class="reference internal" href="#api" id="id3">API</a></p></li>
<li><p><a class="reference internal" href="#feature-requirements" id="id4">Feature Requirements</a></p>
<ul>
<li><p><a class="reference internal" href="#device-enumeration" id="id5">Device enumeration</a></p></li>
<li><p><a class="reference internal" href="#independent-camera-devices" id="id6">Independent Camera Devices</a></p></li>
<li><p><a class="reference internal" href="#multiple-streams-support" id="id7">Multiple streams support</a></p></li>
<li><p><a class="reference internal" href="#per-frame-controls" id="id8">Per frame controls</a></p></li>
<li><p><a class="reference internal" href="#capability-enumeration" id="id9">Capability Enumeration</a></p></li>
<li><p><a class="reference internal" href="#device-profiles" id="id10">Device Profiles</a></p></li>
<li><p><a class="reference internal" href="#a-and-image-enhancement-algorithms" id="id11">3A and Image Enhancement Algorithms</a></p></li>
<li><p><a class="reference internal" href="#closed-source-3a-component-sandboxing" id="id12">Closed-source 3A Component Sandboxing</a></p></li>
<li><p><a class="reference internal" href="#v4l2-compatibility-layer" id="id13">V4L2 Compatibility Layer</a></p></li>
<li><p><a class="reference internal" href="#android-camera-hal-v3-compatibility" id="id14">Android Camera HAL v3 Compatibility</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#camera-stack" id="id15">Camera Stack</a></p></li>
<li><p><a class="reference internal" href="#libcamera-architecture" id="id16">libcamera Architecture</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id17">V4L2 Compatibility Layer</a></p></li>
<li><p><a class="reference internal" href="#android-camera-hal" id="id18">Android Camera HAL</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="documentation">
<h1><a class="toc-backref" href="#id2">Documentation</a><a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="api">
<h2><a class="toc-backref" href="#id3">API</a><a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>The libcamera API is extensively documented using Doxygen. The <a class="reference internal" href="api-html/index.html#api"><span class="std std-ref">API
nightly build</span></a> contains the most up-to-date API documentation, built from
the latest master branch.</p>
</div>
<div class="section" id="feature-requirements">
<h2><a class="toc-backref" href="#id4">Feature Requirements</a><a class="headerlink" href="#feature-requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="device-enumeration">
<h3><a class="toc-backref" href="#id5">Device enumeration</a><a class="headerlink" href="#device-enumeration" title="Permalink to this headline">¶</a></h3>
<p>The library shall support enumerating all camera devices available in the
system, including both fixed cameras and hotpluggable cameras. It shall
support cameras plugged and unplugged after the initialization of the
library, and shall offer a mechanism to notify applications of camera plug
and unplug.</p>
<p>The following types of cameras shall be supported:</p>
<ul class="simple">
<li><p>Internal cameras designed for point-and-shoot still image and video
capture usage, either controlled directly by the CPU, or exposed through
an internal USB bus as a UVC device.</p></li>
<li><p>External UVC cameras designed for video conferencing usage.</p></li>
</ul>
<p>Other types of camera, including analog cameras, depth cameras, thermal
cameras, external digital picture or movie cameras, are out of scope for
this project.</p>
<p>A hardware device that includes independent camera sensors, such as front
and back sensors in a phone, shall be considered as multiple camera devices
for the purpose of this library.</p>
</div>
<div class="section" id="independent-camera-devices">
<h3><a class="toc-backref" href="#id6">Independent Camera Devices</a><a class="headerlink" href="#independent-camera-devices" title="Permalink to this headline">¶</a></h3>
<p>When multiple cameras are present in the system and are able to operate
independently from each other, the library shall expose them as multiple
camera devices and support parallel operation without any additional usage
restriction apart from the limitations inherent to the hardware (such as
memory bandwidth, CPU usage or number of CSI-2 receivers for instance).</p>
<p>Independent processes shall be able to use independent cameras devices
without interfering with each other. A single camera device shall be
usable by a single process at a time.</p>
</div>
<div class="section" id="multiple-streams-support">
<h3><a class="toc-backref" href="#id7">Multiple streams support</a><a class="headerlink" href="#multiple-streams-support" title="Permalink to this headline">¶</a></h3>
<p>The library shall support multiple video streams running in parallel
for each camera device, within the limits imposed by the system.</p>
</div>
<div class="section" id="per-frame-controls">
<h3><a class="toc-backref" href="#id8">Per frame controls</a><a class="headerlink" href="#per-frame-controls" title="Permalink to this headline">¶</a></h3>
<p>The library shall support controlling capture parameters for each stream
on a per-frame basis, on a best effort basis based on the capabilities of the
hardware and underlying software stack (including kernel drivers and
firmware). It shall apply capture parameters to the frame they target, and
report the value of the parameters that have effectively been used for each
captured frame.</p>
<p>When a camera device supports multiple streams, the library shall allow both
control of each stream independently, and control of multiple streams
together. Streams that are controlled together shall be synchronized. No
synchronization is required for streams controlled independently.</p>
</div>
<div class="section" id="capability-enumeration">
<h3><a class="toc-backref" href="#id9">Capability Enumeration</a><a class="headerlink" href="#capability-enumeration" title="Permalink to this headline">¶</a></h3>
<p>The library shall expose capabilities of each camera device in a way that
allows applications to discover those capabilities dynamically. Applications
shall be allowed to cache capabilities for as long as they are using the
library. If capabilities can change at runtime, the library shall offer a
mechanism to notify applications of such changes. Applications shall not
cache capabilities in long term storage between runs.</p>
<p>Capabilities shall be discovered dynamically at runtime from the device when
possible, and may come, in part or in full, from platform configuration
data.</p>
</div>
<div class="section" id="device-profiles">
<h3><a class="toc-backref" href="#id10">Device Profiles</a><a class="headerlink" href="#device-profiles" title="Permalink to this headline">¶</a></h3>
<p>The library may define different camera device profiles, each with a minimum
set of required capabilities. Applications may use those profiles to quickly
determine the level of features exposed by a device without parsing the full
list of capabilities. Camera devices may implement additional capabilities
on top of the minimum required set for the profile they expose.</p>
</div>
<div class="section" id="a-and-image-enhancement-algorithms">
<h3><a class="toc-backref" href="#id11">3A and Image Enhancement Algorithms</a><a class="headerlink" href="#a-and-image-enhancement-algorithms" title="Permalink to this headline">¶</a></h3>
<p>The camera devices shall implement auto exposure, auto gain and auto white
balance. Camera devices that include a focus lens shall implement auto
focus. Additional image enhancement algorithms, such as noise reduction or
video stabilization, may be implemented.</p>
<p>All algorithms may be implemented in hardware or firmware outside of the
library, or in software in the library. They shall all be controllable by
applications.</p>
<p>The library shall be architectured to isolate the 3A and image enhancement
algorithms in a component with a documented API, respectively called the 3A
component and the 3A API. The 3A API shall be stable, and shall allow both
open-source and closed-source implementations of the 3A component.</p>
<p>The library may include statically-linked open-source 3A components, and
shall support dynamically-linked open-source and closed-source 3A
components.</p>
</div>
<div class="section" id="closed-source-3a-component-sandboxing">
<h3><a class="toc-backref" href="#id12">Closed-source 3A Component Sandboxing</a><a class="headerlink" href="#closed-source-3a-component-sandboxing" title="Permalink to this headline">¶</a></h3>
<p>For security purposes, it may be desired to run closed-source 3A components
in a separate process. The 3A API would in such a case be transported over
IPC. The 3A API shall make it possible to use any IPC mechanism that
supports passing file descriptors.</p>
<p>The library may implement an IPC mechanism, and shall support third-party
platform-specific IPC mechanisms through the implementation of a
platform-specific 3A API wrapper. No modification to the library shall be
needed to use such third-party IPC mechanisms.</p>
<p>The 3A component shall not directly access any device node on the system.
Such accesses shall instead be performed through the 3A API. The library
shall validate all accesses and restrict them to what is absolutely required
by 3A components.</p>
</div>
<div class="section" id="v4l2-compatibility-layer">
<h3><a class="toc-backref" href="#id13">V4L2 Compatibility Layer</a><a class="headerlink" href="#v4l2-compatibility-layer" title="Permalink to this headline">¶</a></h3>
<p>The project shall support traditional V4L2 application through an additional
libcamera wrapper library. The wrapper library shall trap all accesses to
camera devices through <cite>LD_PRELOAD</cite>, and route them through libcamera to
emulate a high-level V4L2 camera device. It shall expose camera device
features on a best-effort basis, and aim for the level of features
traditionally available from a UVC camera designed for video conferencing.</p>
</div>
<div class="section" id="android-camera-hal-v3-compatibility">
<h3><a class="toc-backref" href="#id14">Android Camera HAL v3 Compatibility</a><a class="headerlink" href="#android-camera-hal-v3-compatibility" title="Permalink to this headline">¶</a></h3>
<p>The library API shall expose all the features required to implement an
Android Camera HAL v3 on top of libcamera. Some features of the HAL may be
omitted as long as they can be implemented separately in the HAL, such as
JPEG encoding, or YUV reprocessing.</p>
</div>
</div>
<div class="section" id="camera-stack">
<h2><a class="toc-backref" href="#id15">Camera Stack</a><a class="headerlink" href="#camera-stack" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> a c /    +-------------+  +-------------+  +-------------+  +-------------+
 p a |    |   Native    |  |  Framework  |  |   Native    |  |   Android   |
 p t |    |    V4L2     |  | Application |  |  libcamera  |  |   Camera    |
 l i |    | Application |  | (gstreamer) |  | Application |  |  Framework  |
 i o \    +-------------+  +-------------+  +-------------+  +-------------+
   n             ^                ^                ^                ^
                 |                |                |                |
 l a             |                |                |                |
 i d             v                v                |                v
 b a /    +-------------+  +-------------+         |         +-------------+
 c p |    |    V4L2     |  |   Camera    |         |         |   Android   |
 a t |    |   Compat.   |  |  Framework  |         |         |   Camera    |
 m a |    |             |  | (gstreamer) |         |         |     HAL     |
 e t \    +-------------+  +-------------+         |         +-------------+
 r i             ^                ^                |                ^
 a o             |                |                |                |
   n             |                |                |                |
     /           |         ,................................................
     |           |         !      :            Language             :      !
 l f |           |         !      :            Bindings             :      !
 i r |           |         !      :           (optional)            :      !
 b a |           |         \...............................................&#39;
 c m |           |                |                |                |
 a e |           |                |                |                |
 m w |           v                v                v                v
 e o |    +----------------------------------------------------------------+
 r r |    |                                                                |
 a k |    |                           libcamera                            |
     |    |                                                                |
     \    +----------------------------------------------------------------+
                         ^                  ^                  ^
 Userspace               |                  |                  |
------------------------ | ---------------- | ---------------- | ---------------
 Kernel                  |                  |                  |
                         v                  v                  v
                   +-----------+      +-----------+      +-----------+
                   |   Media   | &lt;--&gt; |   Video   | &lt;--&gt; |   V4L2    |
                   |  Device   |      |  Device   |      |  Subdev   |
                   +-----------+      +-----------+      +-----------+
</pre></div>
</div>
<p>The camera stack comprises four software layers. From bottom to top:</p>
<ul>
<li><p>The kernel drivers control the camera hardware and expose a
low-level interface to userspace through the Linux kernel V4L2
family of APIs (Media Controller API, V4L2 Video Device API and
V4L2 Subdev API).</p></li>
<li><p>The libcamera framework is the core part of the stack. It
handles all control of the camera devices in its core component,
libcamera, and exposes a native C++ API to upper layers. Optional
language bindings allow interfacing to libcamera from other
programming languages.</p>
<p>Those components live in the same source code repository and
all together constitute the libcamera framework.</p>
</li>
<li><p>The libcamera adaptation is an umbrella term designating the
components that interface to libcamera in other frameworks.
Notable examples are a V4L2 compatibility layer, a gstreamer
libcamera element, and an Android camera HAL implementation based
on libcamera.</p>
<p>Those components can live in the libcamera project source code
in separate repositories, or move to their respective project’s
repository (for instance the gstreamer libcamera element).</p>
</li>
<li><p>The applications and upper level frameworks are based on the
libcamera framework or libcamera adaptation, and are outside of
the scope of the libcamera project.</p></li>
</ul>
</div>
<div class="section" id="libcamera-architecture">
<h2><a class="toc-backref" href="#id16">libcamera Architecture</a><a class="headerlink" href="#libcamera-architecture" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------&lt;</span> <span class="n">libcamera</span> <span class="n">Public</span> <span class="n">API</span> <span class="o">&gt;---------------------------</span>
                 <span class="o">^</span>                                      <span class="o">^</span>
                 <span class="o">|</span>                                      <span class="o">|</span>
                 <span class="n">v</span>                                      <span class="n">v</span>
          <span class="o">+-------------+</span>  <span class="o">+-------------------------------------------------+</span>
          <span class="o">|</span>   <span class="n">Camera</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">Camera</span> <span class="n">Device</span>                                  <span class="o">|</span>
          <span class="o">|</span>   <span class="n">Devices</span>   <span class="o">|</span>  <span class="o">|</span> <span class="o">+---------------------------------------------+</span> <span class="o">|</span>
          <span class="o">|</span>   <span class="n">Manager</span>   <span class="o">|</span>  <span class="o">|</span> <span class="o">|</span> <span class="n">Device</span><span class="o">-</span><span class="n">Agnostic</span>                             <span class="o">|</span> <span class="o">|</span>
          <span class="o">+-------------+</span>  <span class="o">|</span> <span class="o">|</span>                                             <span class="o">|</span> <span class="o">|</span>
                 <span class="o">^</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">+------------------------+</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>   <span class="o">~~~~~~~~~~~~~~~~~~~~~</span>  <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>  <span class="p">{</span>  <span class="o">+---------------+</span>  <span class="p">}</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>  <span class="p">}</span>  <span class="o">|</span> <span class="o">////</span><span class="n">Image</span><span class="o">////</span> <span class="o">|</span>  <span class="p">{</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span> <span class="o">&lt;-&gt;</span> <span class="o">|</span> <span class="o">/</span><span class="n">Processing</span><span class="o">//</span> <span class="o">|</span>  <span class="p">}</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>  <span class="p">}</span>  <span class="o">|</span> <span class="o">/</span><span class="n">Algorithms</span><span class="o">//</span> <span class="o">|</span>  <span class="p">{</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>  <span class="p">{</span>  <span class="o">+---------------+</span>  <span class="p">}</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>   <span class="o">~~~~~~~~~~~~~~~~~~~~~</span>  <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span> <span class="o">========================</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>     <span class="o">+---------------+</span>    <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>     <span class="o">|</span> <span class="o">//</span><span class="n">Pipeline</span><span class="o">///</span> <span class="o">|</span>    <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span> <span class="o">&lt;-&gt;</span> <span class="o">|</span> <span class="o">///</span><span class="n">Handler</span><span class="o">///</span> <span class="o">|</span>    <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span>                    <span class="o">|</span>     <span class="o">|</span> <span class="o">/////////////</span> <span class="o">|</span>    <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span> <span class="o">+--------------------+</span>     <span class="o">+---------------+</span>    <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">|</span>                                 <span class="n">Device</span><span class="o">-</span><span class="n">Specific</span> <span class="o">|</span>
                 <span class="o">|</span>         <span class="o">+-------------------------------------------------+</span>
                 <span class="o">|</span>                     <span class="o">^</span>                        <span class="o">^</span>
                 <span class="o">|</span>                     <span class="o">|</span>                        <span class="o">|</span>
                 <span class="n">v</span>                     <span class="n">v</span>                        <span class="n">v</span>
        <span class="o">+--------------------------------------------------------------------+</span>
        <span class="o">|</span> <span class="n">Helpers</span> <span class="ow">and</span> <span class="n">Support</span> <span class="n">Classes</span>                                        <span class="o">|</span>
        <span class="o">|</span> <span class="o">+-------------+</span>  <span class="o">+-------------+</span>  <span class="o">+-------------+</span>  <span class="o">+-------------+</span> <span class="o">|</span>
        <span class="o">|</span> <span class="o">|</span>  <span class="n">MC</span> <span class="o">&amp;</span> <span class="n">V4L2</span>  <span class="o">|</span>  <span class="o">|</span>   <span class="n">Buffers</span>   <span class="o">|</span>  <span class="o">|</span> <span class="n">Sandboxing</span>  <span class="o">|</span>  <span class="o">|</span>   <span class="n">Plugins</span>   <span class="o">|</span> <span class="o">|</span>
        <span class="o">|</span> <span class="o">|</span>   <span class="n">Support</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">Allocator</span>  <span class="o">|</span>  <span class="o">|</span>     <span class="n">IPC</span>     <span class="o">|</span>  <span class="o">|</span>   <span class="n">Manager</span>   <span class="o">|</span> <span class="o">|</span>
        <span class="o">|</span> <span class="o">+-------------+</span>  <span class="o">+-------------+</span>  <span class="o">+-------------+</span>  <span class="o">+-------------+</span> <span class="o">|</span>
        <span class="o">|</span> <span class="o">+-------------+</span>  <span class="o">+-------------+</span>                                   <span class="o">|</span>
        <span class="o">|</span> <span class="o">|</span>  <span class="n">Pipeline</span>   <span class="o">|</span>  <span class="o">|</span>     <span class="o">...</span>     <span class="o">|</span>                                   <span class="o">|</span>
        <span class="o">|</span> <span class="o">|</span>   <span class="n">Runner</span>    <span class="o">|</span>  <span class="o">|</span>             <span class="o">|</span>                                   <span class="o">|</span>
        <span class="o">|</span> <span class="o">+-------------+</span>  <span class="o">+-------------+</span>                                   <span class="o">|</span>
        <span class="o">+--------------------------------------------------------------------+</span>

          <span class="o">///</span> <span class="n">Device</span><span class="o">-</span><span class="n">Specific</span> <span class="n">Components</span>
          <span class="o">~~~</span> <span class="n">Sandboxing</span>
</pre></div>
</div>
<p>While offering a unified API towards upper layers, and presenting
itself as a single library, libcamera isn’t monolithic. It exposes
multiple components through its public API, is built around a set of
separate helpers internally, uses device-specific components and can
load dynamic plugins.</p>
<dl>
<dt>Camera Devices Manager</dt><dd><p>The Camera Devices Manager provides a view of available cameras
in the system. It performs cold enumeration and runtime camera
management, and supports a hotplug notification mechanism in its
public API.</p>
<p>To avoid the cost associated with cold enumeration of all devices
at application start, and to arbitrate concurrent access to camera
devices, the Camera Devices Manager could later be split to a
separate service, possibly with integration in platform-specific
device management.</p>
</dd>
<dt>Camera Device</dt><dd><p>The Camera Device represents a camera device to upper layers. It
exposes full control of the device through the public API, and is
thus the highest level object exposed by libcamera.</p>
<p>Camera Device instances are created by the Camera Devices
Manager. An optional function to create new instances could be exposed
through the public API to speed up initialization when the upper
layer knows how to directly address camera devices present in the
system.</p>
</dd>
<dt>Pipeline Handler</dt><dd><p>The Pipeline Handler manages complex pipelines exposed by the kernel drivers
through the Media Controller and V4L2 APIs. It abstracts pipeline handling to
hide device-specific details to the rest of the library, and implements both
pipeline configuration based on stream configuration, and pipeline runtime
execution and scheduling when needed by the device.</p>
<p>This component is device-specific and is part of the libcamera code base. As
such it is covered by the same free software license as the rest of libcamera
and needs to be contributed upstream by device vendors. The Pipeline Handler
lives in the same process as the rest of the library, and has access to all
helpers and kernel camera-related devices.</p>
</dd>
<dt>Image Processing Algorithms</dt><dd><p>Together with the hardware image processing and hardware statistics
collection, the Image Processing Algorithms implement 3A (Auto-Exposure,
Auto-White Balance and Auto-Focus) and other algorithms. They run on the CPU
and interact with the kernel camera devices to control hardware image
processing based on the parameters supplied by upper layers, closing the
control loop of the ISP.</p>
<p>This component is device-specific and is loaded as an external plugin. It can
be part of the libcamera code base, in which case it is covered by the same
license, or provided externally as an open-source or closed-source component.</p>
<p>The component is sandboxed and can only interact with libcamera through
internal APIs specifically marked as such. In particular it will have no
direct access to kernel camera devices, and all its accesses to image and
metadata will be mediated by dmabuf instances explicitly passed to the
component. The component must be prepared to run in a process separate from
the main libcamera process, and to have a very restricted view of the system,
including no access to networking APIs and limited access to file systems.</p>
<p>The sandboxing mechanism isn’t defined by libcamera. One example
implementation will be provided as part of the project, and platforms vendors
will be able to provide their own sandboxing mechanism as a plugin.</p>
<p>libcamera should provide a basic implementation of Image Processing
Algorithms, to serve as a reference for the internal API. Device vendors are
expected to provide a full-fledged implementation compatible with their
Pipeline Handler. One goal of the libcamera project is to create an
environment in which the community will be able to compete with the
closed-source vendor binaries and develop a high quality open source
implementation.</p>
</dd>
<dt>Helpers and Support Classes</dt><dd><p>While Pipeline Handlers are device-specific, implementations are expected to
share code due to usage of identical APIs towards the kernel camera drivers
and the Image Processing Algorithms. This includes without limitation handling
of the MC and V4L2 APIs, buffer management through dmabuf, and pipeline
discovery, configuration and scheduling. Such code will be factored out to
helpers when applicable.</p>
<p>Other parts of libcamera will also benefit from factoring code out to
self-contained support classes, even if such code is present only once in the
code base, in order to keep the source code clean and easy to read. This
should be the case for instance for plugin management.</p>
</dd>
</dl>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id17">V4L2 Compatibility Layer</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>V4L2 compatibility is achieved through a shared library that traps all
accesses to camera devices and routes them to libcamera to emulate high-level
V4L2 camera devices. It is injected in a process address space through
<cite>LD_PRELOAD</cite> and is completely transparent for applications.</p>
<p>The compatibility layer exposes camera device features on a best-effort basis,
and aims for the level of features traditionally available from a UVC camera
designed for video conferencing.</p>
</div>
<div class="section" id="android-camera-hal">
<h3><a class="toc-backref" href="#id18">Android Camera HAL</a><a class="headerlink" href="#android-camera-hal" title="Permalink to this headline">¶</a></h3>
<p>Camera support for Android is achieved through a generic Android
camera HAL implementation on top of libcamera. The HAL will implement internally
features required by Android and missing from libcamera, such as JPEG encoding
support.</p>
<p>The Android camera HAL implementation will initially target the
LIMITED hardware level, with support for the FULL level then being gradually
implemented.</p>
</div>
</div>
</div>


    </div>
  </div>

  
<footer>
  <div id="signature">
        &copy; Copyright 2018-2023, The libcamera documentation authors.
  </div>
</footer>
</body>
</html>